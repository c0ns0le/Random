#!/usr/bin/nawk -f 

BEGIN {
  cmd="/usr/openv/volmgr/bin/vmoprcmd -devmon pr"
  while ((cmd | getline) > 0) {
    if ($0 ~ /<NONE>/) {
      print "No pending tape requests found."
      exit
    } else if ($2 ~ /^[0-9].*[0-9]$/) {
      if ($0 ~ /\.pitt\.edu$/) {
	system("logger -p info 'NetBackup is requesting tape number " $2 " for host " $NF ".  Please put it in the appropriate drive/robot.'")
	print "NetBackup is requesting tape number " $2 " for host " $NF ".  Please put it in the appropriate drive/robot."
      } else {
	system("logger -p info 'NetBackup is requesting tape number " $2 ".  Please put it in the appropriate drive/robot.'")
	print "NetBackup is requesting tape number " $2 ".  Please put it in the appropriate drive/robot."
      }
    }
  }
}